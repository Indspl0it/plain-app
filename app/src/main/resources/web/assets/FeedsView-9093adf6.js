import{b as ae,u as le,_ as de,a as ie}from"./list-e072a8b8.js";import{_ as ue}from"./FieldId-b62dc289.js";import{_ as ce}from"./Multiselect-83ccda61.js";import{_ as re}from"./Dropdown.vuevuetypescriptsetuptruelang-779785a5.js";import{_ as pe}from"./Breadcrumb-ff325241.js";import{d as _e,p as me,r as i,u as fe,A as he,n as ve,B as ge,bW as be,D as ye,t as Q,bX as ke,i as $e,C as we,bY as Ce,G as Ve,H as Fe,I as R,U as Te,bZ as Ee,o as u,c as p,b as e,e as y,w as T,f as a,v as Qe,J as D,K as De,L as Se,M as z,g as c,N as Ue,F as S,y as P,x as Ae,ab as Ie,k as U,O as qe,P as Be,Q as Le,z as Y,R as H,m as Me}from"./index-415fb171.js";import{c as xe,k as J,b as Ge,a as Ke}from"./search-e7a4b79e.js";import{n as Ne}from"./list-6498ebd9.js";import{a as Re,b as ze}from"./tags-5cd2e3db.js";import"./VModal.vuevuetypescriptsetuptruelang-b3460e44.js";import"./baseIndexOf-70b929c6.js";import"./vee-validate.esm-3b4eb2f1.js";const Pe={class:"v-toolbar"},Ye={class:"right-actions"},He=["disabled","onClick"],Je={class:"row mb-3"},Oe={class:"col-md-3 col-form-label"},We={class:"col-md-9"},Xe=["onKeyup"],Ze={class:"row mb-3"},je={class:"col-md-3 col-form-label"},et={class:"col-md-9"},tt={class:"actions"},st=["onClick"],ot={class:"table"},nt=e("th",null,"ID",-1),at=e("th",null,null,-1),lt=["onClick"],dt=["onUpdate:modelValue"],it=["src"],ut=["href","onClick"],ct={class:"badge"},rt=["title"],pt={key:0},_t={colspan:"7"},mt={class:"no-data-placeholder"},Qt=_e({__name:"FeedsView",setup(ft){var K,N;const A=me(),r=i([]),{t:_}=fe(),l=he({text:"",feeds:[],tags:[]}),k="FEED_ENTRY",I=ve().query,$=i(parseInt(((K=I.page)==null?void 0:K.toString())??"1")),w=50,C=i(0),V=i([]),O=i([]),m=i(ge(((N=I.q)==null?void 0:N.toString())??"")),q=i(""),{addToTags:W}=Re(k,r,V),{removeFromTags:X}=ze(k,r,V),{deleteItems:Z}=ae(be,()=>{L()},r),F=i(!1),j=[{text:_("add_to_tags"),click:W},{text:_("remove_from_tags"),click:X},{text:_("delete"),click:Z}],{selectAll:E,toggleSelect:B}=le(r),{loading:ee,load:te,refetch:L}=ye({handle:(t,o)=>{o?Q(_(o),"error"):t&&(r.value=t.feedEntries.map(f=>({...f,checked:!1})),C.value=t.feedEntryCount)},document:ke,variables:()=>({offset:($.value-1)*w,limit:w,query:q.value}),appApi:!0});$e({handle:async(t,o)=>{if(o)Q(_(o),"error");else if(t){V.value=t.tags,O.value=t.feeds;const f=xe(m.value);l.tags=[];const h=[],v=[];f.forEach(n=>{if(n.name==="text")l.text=n.value;else if(n.name==="tag"){const d=t.tags.find(s=>J(s.name)===n.value);d?(l.tags.push(d),h.push(d.id)):h.push("invalid")}else if(n.name==="feed"){const d=t.feeds.find(s=>J(s.name)===n.value);d?(l.feeds.push(d),v.push(d.id)):v.push("invalid")}});const g=[...f].filter(n=>n.name!=="tag"&&n.name!=="feed");h.forEach(n=>{g.push({name:"tag_id",op:"",value:n})}),v.forEach(n=>{g.push({name:"feed_id",op:"",value:n})}),q.value=Ge(g),await we(),te()}},document:Ce,variables:{type:k},appApi:!0}),Ve($,t=>{Y(A,`/feeds?page=${t}&q=${H(m.value)}`)});function M(){m.value=Ke(l),x()}function x(){Y(A,`/feeds?q=${H(m.value)}`)}Fe(()=>{R.on("refetch_by_tag_type",t=>{t===k&&L()}),R.on("feeds_fetched",t=>{F.value=!1,Q(t.error||_("feeds_synced"))})});function se(t){Me.push(G(t))}function G(t){return`/feeds/${t.feedId}/entries/${t.id}`}const{mutate:oe}=Te({document:Ee,appApi:!0});function ne(){F.value=!0,oe({id:""})}return(t,o)=>{const f=pe,h=re,v=ce,g=de,n=ue,d=ie;return u(),p(S,null,[e("div",Pe,[y(f,{current:()=>`${t.$t("page_title.feeds")} (${C.value})`},null,8,["current"]),e("div",Ye,[e("button",{class:"btn btn-action",disabled:F.value,type:"button",onClick:T(ne,["prevent"])},a(F.value?t.$t("syncing"):t.$t("sync_feeds")),9,He),y(h,{title:t.$t("actions"),items:j},null,8,["title"]),y(g,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=s=>m.value=s),search:x},{filters:Qe(()=>[e("div",Je,[e("label",Oe,a(t.$t("keywords")),1),e("div",We,[D(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>l.text=s),class:"form-control",onKeyup:Se(M,["enter"])},null,40,Xe),[[De,l.text]])])]),e("div",Ze,[e("label",je,a(t.$t("tags")),1),e("div",et,[y(v,{modelValue:l.tags,"onUpdate:modelValue":o[1]||(o[1]=s=>l.tags=s),label:"name","track-by":"id",options:V.value},null,8,["modelValue","options"])])]),e("div",tt,[e("button",{type:"button",class:"btn",onClick:T(M,["stop"])},a(t.$t("search")),9,st)])]),_:1},8,["modelValue"])])]),e("table",ot,[e("thead",null,[e("tr",null,[e("th",null,[D(e("input",{class:"form-check-input",type:"checkbox",onChange:o[3]||(o[3]=(...s)=>c(B)&&c(B)(...s)),"onUpdate:modelValue":o[4]||(o[4]=s=>Ue(E)?E.value=s:null)},null,544),[[z,c(E)]])]),nt,at,e("th",null,a(t.$t("title")),1),e("th",null,a(t.$t("source")),1),e("th",null,a(t.$t("tags")),1),e("th",null,a(t.$t("published_at")),1)])]),e("tbody",null,[(u(!0),p(S,null,P(r.value,s=>(u(),p("tr",{key:s.id,class:Ae({checked:s.checked}),onClick:T(b=>s.checked=!s.checked,["stop"])},[e("td",null,[D(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":b=>s.checked=b},null,8,dt),[[z,s.checked]])]),e("td",null,[y(n,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",null,[s.image?(u(),p("img",{key:0,src:c(Ie)(s.image)+"&w=200&h=200",width:"50",height:"50"},null,8,it)):U("",!0)]),e("td",null,[e("a",{href:G(s),onClick:T(b=>se(s),["prevent"])},a(s.title||t.$t("no_content")),9,ut)]),e("td",null,a(s.author),1),e("td",null,[(u(!0),p(S,null,P(s.tags,b=>(u(),p("span",ct,a(b.name),1))),256))]),e("td",{class:"nowrap",title:c(qe)(s.publishedAt)},a(c(Be)(s.publishedAt)),9,rt)],10,lt))),128))]),r.value.length?U("",!0):(u(),p("tfoot",pt,[e("tr",null,[e("td",_t,[e("div",mt,a(t.$t(c(Ne)(c(ee)))),1)])])]))]),C.value>w?(u(),Le(d,{key:0,modelValue:$.value,"onUpdate:modelValue":o[5]||(o[5]=s=>$.value=s),total:C.value,limit:w},null,8,["modelValue","total"])):U("",!0)],64)}}});export{Qt as default};
