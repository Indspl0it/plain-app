import{a as ae,b as le,e as de,c as ie,_ as ce,d as ue}from"./list-e7ef4cf1.js";import{_ as re}from"./FieldId-da304ce7.js";import{_ as pe}from"./Multiselect-90c04a89.js";import{_ as _e}from"./Dropdown.vuevuetypescriptsetuptruelang-172ac0f4.js";import{_ as me}from"./Breadcrumb-23f5606f.js";import{d as fe,n as he,r as i,u as ve,A as ge,m as be,B as ye,bU as ke,D as $e,t as Q,bV as we,i as Ve,C as Ce,bW as Fe,G as Te,H as Ee,I as R,U as Qe,bX as Ue,o as c,c as p,a as e,b as y,w as T,e as a,q as De,J as U,K as Se,L as Ae,M as z,j as u,N as Ie,F as D,v as P,s as qe,a9 as Be,g as S,O as Le,P as Me,Q as xe,x as j,R as H,l as Ge}from"./index-89decb33.js";import{c as Ke,k as J,b as Ne,a as Re}from"./search-0684184d.js";import{n as ze}from"./list-6498ebd9.js";import"./VModal.vuevuetypescriptsetuptruelang-6d140002.js";import"./vee-validate.esm-09f61400.js";import"./baseIndexOf-70b929c6.js";const Pe={class:"v-toolbar"},je={class:"right-actions"},He=["disabled","onClick"],Je={class:"row mb-3"},Oe={class:"col-md-3 col-form-label"},We={class:"col-md-9"},Xe=["onKeyup"],Ye={class:"row mb-3"},Ze={class:"col-md-3 col-form-label"},et={class:"col-md-9"},tt={class:"actions"},st=["onClick"],ot={class:"table"},nt=e("th",null,"ID",-1),at=e("th",null,null,-1),lt=["onClick"],dt=["onUpdate:modelValue"],it=["src"],ct=["href","onClick"],ut={class:"badge"},rt=["title"],pt={key:0},_t={colspan:"7"},mt={class:"no-data-placeholder"},Et=fe({__name:"FeedsView",setup(ft){var K,N;const A=he(),r=i([]),{t:_}=ve(),l=ge({text:"",feeds:[],tags:[]}),k="FEED_ENTRY",I=be().query,$=i(parseInt(((K=I.page)==null?void 0:K.toString())??"1")),w=50,V=i(0),C=i([]),O=i([]),m=i(ye(((N=I.q)==null?void 0:N.toString())??"")),q=i(""),{addToTags:W}=ae(k,r,C),{removeFromTags:X}=le(k,r,C),{deleteItems:Y}=de(ke,()=>{L()},r),F=i(!1),Z=[{text:_("add_to_tags"),click:W},{text:_("remove_from_tags"),click:X},{text:_("delete"),click:Y}],{selectAll:E,toggleSelect:B}=ie(r),{loading:ee,load:te,refetch:L}=$e({handle:(t,o)=>{o?Q(_(o),"error"):t&&(r.value=t.feedEntries.map(f=>({...f,checked:!1})),V.value=t.feedEntryCount)},document:we,variables:()=>({offset:($.value-1)*w,limit:w,query:q.value}),appApi:!0});Ve({handle:async(t,o)=>{if(o)Q(_(o),"error");else if(t){C.value=t.tags,O.value=t.feeds;const f=Ke(m.value);l.tags=[];const h=[],v=[];f.forEach(n=>{if(n.name==="text")l.text=n.value;else if(n.name==="tag"){const d=t.tags.find(s=>J(s.name)===n.value);d?(l.tags.push(d),h.push(d.id)):h.push("invalid")}else if(n.name==="feed"){const d=t.feeds.find(s=>J(s.name)===n.value);d?(l.feeds.push(d),v.push(d.id)):v.push("invalid")}});const g=[...f].filter(n=>n.name!=="tag"&&n.name!=="feed");h.forEach(n=>{g.push({name:"tag_id",op:"",value:n})}),v.forEach(n=>{g.push({name:"feed_id",op:"",value:n})}),q.value=Ne(g),await Ce(),te()}},document:Fe,variables:{type:k},appApi:!0}),Te($,t=>{j(A,`/feeds?page=${t}&q=${H(m.value)}`)});function M(){m.value=Re(l),x()}function x(){j(A,`/feeds?q=${H(m.value)}`)}Ee(()=>{R.on("refetch_by_tag_type",t=>{t===k&&L()}),R.on("feeds_fetched",t=>{F.value=!1,Q(t.error||_("feeds_synced"))})});function se(t){Ge.push(G(t))}function G(t){return`/feeds/${t.feedId}/entries/${t.id}`}const{mutate:oe}=Qe({document:Ue,appApi:!0});function ne(){F.value=!0,oe({id:""})}return(t,o)=>{const f=me,h=_e,v=pe,g=ce,n=re,d=ue;return c(),p(D,null,[e("div",Pe,[y(f,{current:()=>`${t.$t("page_title.feeds")} (${V.value})`},null,8,["current"]),e("div",je,[e("button",{class:"btn btn-action",disabled:F.value,type:"button",onClick:T(ne,["prevent"])},a(F.value?t.$t("syncing"):t.$t("sync_feeds")),9,He),y(h,{title:t.$t("actions"),items:Z},null,8,["title"]),y(g,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=s=>m.value=s),search:x},{filters:De(()=>[e("div",Je,[e("label",Oe,a(t.$t("keywords")),1),e("div",We,[U(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>l.text=s),class:"form-control",onKeyup:Ae(M,["enter"])},null,40,Xe),[[Se,l.text]])])]),e("div",Ye,[e("label",Ze,a(t.$t("tags")),1),e("div",et,[y(v,{modelValue:l.tags,"onUpdate:modelValue":o[1]||(o[1]=s=>l.tags=s),label:"name","track-by":"id",options:C.value},null,8,["modelValue","options"])])]),e("div",tt,[e("button",{type:"button",class:"btn",onClick:T(M,["stop"])},a(t.$t("search")),9,st)])]),_:1},8,["modelValue"])])]),e("table",ot,[e("thead",null,[e("tr",null,[e("th",null,[U(e("input",{class:"form-check-input",type:"checkbox",onChange:o[3]||(o[3]=(...s)=>u(B)&&u(B)(...s)),"onUpdate:modelValue":o[4]||(o[4]=s=>Ie(E)?E.value=s:null)},null,544),[[z,u(E)]])]),nt,at,e("th",null,a(t.$t("title")),1),e("th",null,a(t.$t("source")),1),e("th",null,a(t.$t("tags")),1),e("th",null,a(t.$t("published_at")),1)])]),e("tbody",null,[(c(!0),p(D,null,P(r.value,s=>(c(),p("tr",{key:s.id,class:qe({checked:s.checked}),onClick:T(b=>s.checked=!s.checked,["stop"])},[e("td",null,[U(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":b=>s.checked=b},null,8,dt),[[z,s.checked]])]),e("td",null,[y(n,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",null,[s.image?(c(),p("img",{key:0,src:u(Be)(s.image)+"&w=200&h=200",width:"50",height:"50"},null,8,it)):S("",!0)]),e("td",null,[e("a",{href:G(s),onClick:T(b=>se(s),["prevent"])},a(s.title||t.$t("no_content")),9,ct)]),e("td",null,a(s.author),1),e("td",null,[(c(!0),p(D,null,P(s.tags,b=>(c(),p("span",ut,a(b.name),1))),256))]),e("td",{class:"nowrap",title:u(Le)(s.publishedAt)},a(u(Me)(s.publishedAt)),9,rt)],10,lt))),128))]),r.value.length?S("",!0):(c(),p("tfoot",pt,[e("tr",null,[e("td",_t,[e("div",mt,a(t.$t(u(ze)(u(ee)))),1)])])]))]),V.value>w?(c(),xe(d,{key:0,modelValue:$.value,"onUpdate:modelValue":o[5]||(o[5]=s=>$.value=s),total:V.value,limit:w},null,8,["modelValue","total"])):S("",!0)],64)}}});export{Et as default};
