import{o as i,c as d,b as l,d as re,U as ue,Y as Pe,a1 as ze,Q as y,v as M,f as m,g as a,u as Le,r as b,n as Qe,B as We,p as je,s as ee,a as Ge,ae as Ze,as as Je,t as te,av as Oe,X as x,G as Xe,H as Ke,I as Ye,e as E,k as p,J as U,M as R,N as et,F as $,y as se,x as tt,aQ as oe,aR as ae,ab as st,j as T,P as ot,l as A,aj as at,aS as nt,_ as it}from"./index-400f4a7b.js";import{_ as lt}from"./Dropdown.vuevuetypescriptsetuptruelang-24c50f04.js";import{_ as ct}from"./Breadcrumb-7c24ea6b.js";import{c as ne}from"./index-074527a8.js";import{g as ie,M as rt}from"./splitpanes.es-a783b760.js";import{n as ut}from"./list-6498ebd9.js";import{a as dt,b as mt,c as pt,d as ht,e as _t,f as ft,g as vt,h as kt,u as bt,i as yt}from"./files-c27a9b6d.js";import{_ as gt}from"./VModal.vuevuetypescriptsetuptruelang-610de861.js";import{t as Ct}from"./truncate-8aa8972f.js";import{_ as le}from"./EditValueModal.vuevuetypescriptsetuptruelang-ccce301d.js";import{c as Dt}from"./search-e9047456.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-66ec8fce.js";import"./stringToArray-21332271.js";import"./vee-validate.esm-5d9cc34a.js";const Vt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},wt=l("path",{fill:"currentColor",d:"M4 20q-.825 0-1.413-.588T2 18V6q0-.825.588-1.413T4 4h5.175q.4 0 .763.15t.637.425L12 6h8q.825 0 1.413.588T22 8v10q0 .825-.588 1.413T20 20H4ZM4 6v12h16V8h-8.825l-2-2H4Zm0 0v12V6Z"},null,-1),xt=[wt];function $t(g,s){return i(),d("svg",Vt,xt)}const Tt={name:"material-symbols-folder-outline-rounded",render:$t},Mt=["disabled"],ce=re({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(g){const s=g,{mutate:C,loading:H,onDone:F}=ue({document:Pe`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function D(){C({paths:s.files.map(h=>h.path)})}return F(()=>{s.onDone(s.files),ze()}),(h,f)=>{const S=gt;return i(),y(S,{class:"delete-modal",title:h.$t("confirm_to_delete_name",{name:a(Ct)(g.files.map(_=>_.name).join(", "),{length:200})})},{action:M(()=>[l("button",{type:"button",disabled:a(H),class:"btn",onClick:D},m(h.$t("delete")),9,Mt)]),_:1},8,["title"])}}}),Ft={class:"page-container container"},St={class:"main"},It={class:"v-toolbar"},qt={class:"right-actions"},Bt={class:"form-check mt-2 me-4"},Et={class:"form-check-label",for:"select-mode"},Ut={class:"form-check mt-2"},Rt={class:"form-check-label",for:"show-hidden"},At={class:"file-items"},Ht=["onClick","onDblclick","onContextmenu"],Nt=["onUpdate:modelValue"],Pt=["src"],zt={class:"title"},Lt={style:{"font-size":"0.75rem"}},Qt=["onContextmenu"],Wt={key:0,class:"no-files"},jt={key:0,class:"file-item-info"},Gt=re({__name:"FilesView",setup(g){var O,X,K;const{t:s}=Le(),C=b([]),F=Qe().query,D=b(We(((O=F.q)==null?void 0:O.toString())??"")),h=Dt(D.value),f=b(((X=h.find(e=>e.name==="path"))==null?void 0:X.value)??""),S=b(((K=h.find(e=>e.name==="dir"))==null?void 0:K.value)??""),_=b(!1),N=je(),{app:V}=ee(Ge()),{loading:de,panels:u,currentDir:I,refetch:P}=dt(V,S.value),{visible:me,index:pe,view:he,hide:_e}=Ze(),{createPath:fe,createVariables:ve,createMutation:ke}=mt(V,u),{renameValue:be,renamePath:ye,renameDone:ge,renameMutation:Ce,renameVariables:De}=pt(u),{totalBytes:Ve,freeBytes:we,refetch:q}=ht(),{onDeleted:z}=kt(u,I,q),{downloadFile:L,downloadDir:xe,downloadFiles:$e}=bt(V),{view:Q}=yt(C,he),{selectedItem:w,select:Te}=_t(I,D,N),{canPaste:W,copy:j,cut:Me,paste:B}=ft(P,q),{input:Fe,upload:G,uploadChanged:Z}=vt(),{mutate:Se,onDone:Ie}=ue({document:Je,appApi:!0});Ie(e=>{$e(e.data.setTempValue.key)});const qe=[{text:s("download"),click:()=>{const e=[];if(u.value.forEach(t=>{t.items.forEach(o=>{o.checked&&e.push(o.path)})}),e.length===0){te(s("select_first"),"error");return}Se({key:Oe(),value:JSON.stringify(e)})}},{text:s("delete"),click:()=>{const e=[];if(u.value.forEach(t=>{t.items.forEach(o=>{o.checked&&e.push(o)})}),e.length===0){te(s("select_first"),"error");return}x(ce,{files:e,onDone:z})}}],{fileShowHidden:v}=ee(N);f.value&&Xe(()=>u.value.length,()=>{if(u.value.length>0&&f.value){const t=u.value[u.value.length-1].items.find(o=>o.path===f.value);t&&(w.value=t,f.value="")}});function Be(){return`${s("page_title.files")} (${s("storage_free_total",{free:A(we.value),total:A(Ve.value)})})`}function Ee(e,t){if(_.value){t.checked=!t.checked;return}Te(e,t)}function J(e){return oe(e.name)||ae(e.name)||nt(e.name)}function Ue(e,t){t.isDir||(J(t)?Q(e,t):L(t.path))}function Re(e,t){e.preventDefault();const o=[{label:s("create_folder"),onClick:()=>{fe.value=t,x(le,{title:s("name"),placeholder:s("name"),mutation:ke,getVariables:ve})}},{label:s("upload_files"),onClick:()=>{G(t)}}];W()&&o.push({label:s("paste"),onClick:()=>{B(t)}}),ne({x:e.x,y:e.y,items:o})}function Ae(e,t,o){e.preventDefault();let c;o.isDir?c=[{label:s("upload_files"),onClick:()=>{G(o.path)}},{label:s("download"),onClick:()=>{xe(o.path)}}]:(c=[],J(o)&&c.push({label:s("open"),onClick:()=>{Q(t,o)}}),c.push({label:s("download"),onClick:()=>{L(o.path)}})),c.push({label:s("duplicate"),onClick:()=>{j(o),B(t.dir)}}),c.push({label:s("cut"),onClick:()=>{Me(t,o)}}),c.push({label:s("copy"),onClick:()=>{j(o)}}),o.isDir&&W()&&c.push({label:s("paste"),onClick:()=>{B(o.path)}}),c=[...c,{label:s("rename"),onClick:()=>{be.value=o.name,ye.value=o.path,x(le,{title:s("rename"),placeholder:s("name"),value:o.name,mutation:Ce,getVariables:De,done:ge})}},{label:s("delete"),onClick:()=>{x(ce,{files:[o],onDone:z})}}],ne({x:e.x,y:e.y,items:c})}return Ke(()=>{Ye.on("upload_task_done",e=>{e.status==="done"&&setTimeout(()=>{P(e.dir),q()},1e3)})}),(e,t)=>{const o=ct,c=lt,He=Tt,Ne=at;return i(),d("div",Ft,[l("div",St,[l("div",It,[E(o,{current:Be}),l("div",qt,[_.value?(i(),y(c,{key:0,title:e.$t("actions"),items:qe},null,8,["title"])):p("",!0),l("div",Bt,[U(l("input",{class:"form-check-input","onUpdate:modelValue":t[0]||(t[0]=r=>_.value=r),id:"select-mode",type:"checkbox"},null,512),[[R,_.value]]),l("label",Et,m(e.$t("select_mode")),1)]),l("div",Ut,[U(l("input",{class:"form-check-input","onUpdate:modelValue":t[1]||(t[1]=r=>et(v)?v.value=r:null),id:"show-hidden",type:"checkbox"},null,512),[[R,a(v)]]),l("label",Rt,m(e.$t("show_hidden")),1)])])]),E(a(rt),{class:"panel-container"},{default:M(()=>[(i(!0),d($,null,se(a(u),r=>(i(),y(a(ie),{key:r.dir},{default:M(()=>[l("div",At,[(i(!0),d($,null,se(r.items,n=>{var Y;return i(),d($,{key:n.path},[!n.name.startsWith(".")||a(v)?(i(),d("div",{key:0,class:tt(["file-item",{active:(a(I)+"/").startsWith(n.path+"/")||((Y=a(w))==null?void 0:Y.path)===n.path}]),onClick:k=>Ee(r,n),onDblclick:k=>Ue(r,n),onContextmenu:k=>Ae(k,r,n)},[_.value?U((i(),d("input",{key:0,class:"form-check-input","onUpdate:modelValue":k=>n.checked=k,type:"checkbox"},null,8,Nt)),[[R,n.checked]]):p("",!0),n.isDir?(i(),y(He,{key:1,class:"bi"})):p("",!0),a(oe)(n.name)||a(ae)(n.name)?(i(),d("img",{key:2,src:a(st)(n.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Pt)):p("",!0),l("div",zt,[T(m(n.name)+" ",1),l("div",Lt,[T(m(a(ot)(n.updatedAt)),1),n.isDir?p("",!0):(i(),d($,{key:0},[T(", "+m(a(A)(n.size)),1)],64))])])],42,Ht)):p("",!0)],64)}),128)),l("div",{class:"empty",onContextmenu:n=>Re(n,r.dir)},[r.items.filter(n=>!n.name.startsWith(".")||a(v)).length===0?(i(),d("div",Wt,m(e.$t("no_files")),1)):p("",!0)],40,Qt)])]),_:2},1024))),128)),a(u).length===0?(i(),y(a(ie),{key:0,class:"no-data-placeholder"},{default:M(()=>[T(m(e.$t(a(ut)(a(de),a(V).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):p("",!0)]),_:1}),a(w)?(i(),d("div",jt,m(e.$t("path"))+": "+m(a(w).path),1)):p("",!0),E(Ne,{visible:a(me),index:a(pe),sources:C.value,onHide:a(_e)},null,8,["visible","index","sources","onHide"]),l("input",{ref_key:"fileInput",ref:Fe,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...r)=>a(Z)&&a(Z)(...r))},null,544)])])}}});const rs=it(Gt,[["__scopeId","data-v-4f5df19e"]]);export{rs as default};
