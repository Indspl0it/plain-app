import{aR as U,r as i,U as w,aS as V,aT as g,ag as $,aU as L,i as k,aV as C,u as P,t as b,aP as Q,aO as S,aW as M,aX as E,aw as R,R as B,aY as G,aZ as z,s as _,a as O,aM as j,a_ as x,a$ as m,aN as H,b0 as W,aQ as J}from"./index-4e7fbfe1.js";import{b as X}from"./search-3e0e61ee.js";import{b as Y}from"./baseIndexOf-70b929c6.js";import{a as Z}from"./toInteger-039c5f80.js";var q=Math.max;function K(o,n,e){var t=o==null?0:o.length;if(!t)return-1;var a=e==null?0:Z(e);return a<0&&(a=q(t+a,0)),Y(o,U(n),a)}const se=(o,n)=>{const e=i("");return{createPath:e,createVariables(t){return{path:e.value+"/"+t}},createMutation(){return w({document:V,options:{update:async(t,a)=>{const{fileIdToken:s}=o.value;for(const u of n.value)if(u.dir===e.value){const l=a.data.createDir;u.items.push({...l,name:g(l.path),fileId:await $(s,l.path)})}}},appApi:!0})}}},ne=o=>{const n=i(""),e=i("");return{renameValue:n,renamePath:e,renameDone(t){const a=e.value,s=n.value;for(const u of o.value)u.rename(a,s,t)},renameMutation(){return w({document:L,appApi:!0})},renameVariables(t){return{path:e.value,name:t}}}},oe=(o,n,e)=>({onDeleted(t){for(const a of o.value)t.forEach(s=>{a.deleteItem(s.path)});t.forEach(a=>{if(n.value.startsWith(a.path)){const s=a.path.lastIndexOf("/");n.value=a.path.substring(0,s)}}),e()}}),le=()=>{const o=i(0),n=i(0),{refetch:e}=k({handle:(t,a)=>{a||(o.value=t.storageStats.totalBytes,n.value=t.storageStats.freeBytes)},document:C,appApi:!0});return{totalBytes:o,freeBytes:n,refetch:e}},ue=(o,n)=>{const e=i(""),t=i(""),a=i(""),s=i([]),{t:u}=P();let l=0;const{loading:T}=k({handle:async(h,v)=>{if(v)b(u(v),"error");else{const{dir:f,items:I}=h.files;a.value===""&&(e.value=f);const{fileIdToken:y}=o.value,d=[];for(const r of I){const p={...r,name:g(r.path)};(Q(p.name)||S(p.name))&&(p.fileId=await $(y,r.path)),d.push(p)}const c=f.replace(e.value,"").split("/").length;for(;s.value.length>=c;)s.value.pop();if(s.value.push(new M(f,d)),n){const r=n.replace(e.value+"/","").split("/");d.length===0?l=r.length-1:l<r.length&&(a.value=e.value+"/"+r.slice(0,l+1).join("/"),l++)}}},document:E,variables:{dir:a,showHidden:!0},options:{fetchPolicy:"no-cache"},appApi:!0}),{refetch:F}=k({handle:async(h,v)=>{if(v)b(u(v),"error");else{const{dir:f,items:I}=h.files,{fileIdToken:y}=o.value,d=[];for(const c of I)d.push({...c,name:g(c.path),fileId:await $(y,c.path)});s.value.forEach(c=>{c.dir===f&&(c.items=d)})}t.value=""},document:E,variables:{dir:t,showHidden:!0},options:()=>({fetchPolicy:"no-cache",enabled:!!t.value}),appApi:!0});return{loading:T,panels:s,refetch(h){t.value=h,F()},rootDir:e,currentDir:a}},re=o=>({async downloadFile(n,e){const{fileIdToken:t}=o.value,a=await W(t,n);e?m(a+`&dl=1&name=${e}`,e):m(a+"&dl=1",g(n))},async downloadDir(n,e){const{fileIdToken:t}=o.value,a=await $(t,n),s=`${x()}/zip/dir?id=${encodeURIComponent(a)}`;e?m(s+`&name=${e}`,e):m(s,g(n))},downloadFiles(n,e){const t=`${x()}/zip/files?id=${encodeURIComponent(n)}`;e?m(t+`&name=${e}`,e):m(t,"")}}),ie=(o,n)=>({view(e,t){o.value=e.items.filter(s=>S(s.name)||Q(s.name)||J(s.name)).map(s=>({path:s.path,src:"",name:g(s.path)}));const a=K(o.value,s=>s.path===t.path);n(a)}}),ce=(o,n,e)=>{const t=i(null);return{selectedItem:t,select(a,s){s.isDir?o.value=s.path:a.items.some(l=>l.path===o.value)&&a.items.some(l=>l.path===s.path)&&(o.value=a.dir);const u=[];u.push({name:"path",op:"",value:s.path}),u.push({name:"dir",op:"",value:o.value}),n.value=X(u),t.value=s,R(e,`/files?q=${B(n.value)}`)}}},pe=(o,n)=>{const e=i(null),t=i(null),a=i(!1),s=i(),{mutate:u,loading:l,onDone:T,onError:F}=w({document:G,appApi:!0}),{mutate:h,loading:v,onDone:f,onError:I}=w({document:z,appApi:!0}),{t:y}=P(),d=r=>{b(y(r.message))};F(d),I(d);const c=()=>{var r;if(a.value){const p=t.value.items.findIndex(D=>D.path===e.value.path);(r=t.value)==null||r.items.splice(p,1)}e.value=null,setTimeout(()=>{o(s.value),n()},500)};return T(c),f(c),{loading:l||v,canPaste(){return!!e.value},copy(r){e.value=r,a.value=!1},cut(r,p){e.value=p,t.value=r,a.value=!0},paste(r){var D,A;s.value=r;const p={src:(D=e.value)==null?void 0:D.path,dst:r+"/"+((A=e.value)==null?void 0:A.name),overwrite:!1};a.value?h(p):u(p)}}},de=()=>{const{uploads:o}=_(O()),n=i(""),e=i();return{input:e,upload(t){n.value=t,e.value.value="",e.value.click()},uploadChanged(t){const a=t.target.files;if(!a)return;const s=[];for(let u=0;u<a.length;u++){const l=a[u];s.push({dir:n.value,file:l,status:"created",uploadedSize:0,error:""})}o.value=[...o.value,...s]}}},he=(o,n)=>{const{t:e}=P(),{mutate:t,onDone:a}=w({document:j,appApi:!0});return a(s=>{const u=`${x()}/zip/files?id=${encodeURIComponent(s.data.setTempValue.key)}&name=${n}`;m(u,n),o.value.forEach(l=>{l.checked=!1})}),{downloadItems:()=>{const s=o.value.filter(l=>l.checked);if(s.length===0){b(e("select_first"),"error");return}const u=[];s.forEach(l=>{n==="apps.zip"?u.push({path:l.path,name:`${l.name.replace(" ","")}-${l.id}.apk`}):u.push({path:l.path})}),t({key:H(),value:JSON.stringify(u)})}}};export{re as a,ue as b,se as c,ne as d,le as e,ce as f,pe as g,de as h,oe as i,ie as j,he as u};
