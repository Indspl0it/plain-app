import{o as i,c as d,b as r,d as fe,U as ve,Y as Ze,a1 as Je,Q as V,v as q,f as p,g as o,u as Xe,r as C,n as Ke,B as Ye,p as et,s as le,a as tt,ae as st,aM as at,t as ie,aN as ot,X as M,G as nt,H as lt,I as it,e as N,k as h,J as A,M as H,N as rt,F as D,y as re,x as ct,aO as ce,aP as ue,ab as ut,j as S,P as dt,l as w,aj as pt,aQ as mt,_ as ht}from"./index-b61558b0.js";import{_ as _t}from"./Dropdown.vuevuetypescriptsetuptruelang-8cd2dc62.js";import{_ as ft}from"./Breadcrumb-f25190bb.js";import{c as de}from"./index-264c9fe2.js";import{g as pe,M as vt}from"./splitpanes.es-52b41a88.js";import{n as kt}from"./list-6498ebd9.js";import{b as yt,c as bt,d as gt,e as Ct,f as Dt,g as wt,h as me,i as Vt,a as xt,j as $t}from"./files-3f05f8b1.js";import{_ as It}from"./VModal.vuevuetypescriptsetuptruelang-97be675f.js";import{t as Ft}from"./truncate-4ade2530.js";import{_ as he}from"./EditValueModal.vuevuetypescriptsetuptruelang-c69213ac.js";import{c as Tt}from"./search-10c50927.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-3759dfbb.js";import"./stringToArray-38452596.js";import"./vee-validate.esm-3e89ad50.js";const Mt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},St=r("path",{fill:"currentColor",d:"M4 20q-.825 0-1.413-.588T2 18V6q0-.825.588-1.413T4 4h5.175q.4 0 .763.15t.637.425L12 6h8q.825 0 1.413.588T22 8v10q0 .825-.588 1.413T20 20H4ZM4 6v12h16V8h-8.825l-2-2H4Zm0 0v12V6Z"},null,-1),qt=[St];function Bt(x,s){return i(),d("svg",Mt,qt)}const Pt={name:"material-symbols-folder-outline-rounded",render:Bt},Ut=["disabled"],_e=fe({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(x){const s=x,{mutate:$,loading:I,onDone:B}=ve({document:Ze`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function k(){$({paths:s.files.map(_=>_.path)})}return B(()=>{s.onDone(s.files),Je()}),(_,F)=>{const m=It;return i(),V(m,{class:"delete-modal",title:_.$t("confirm_to_delete_name",{name:o(Ft)(x.files.map(f=>f.name).join(", "),{length:200})})},{action:q(()=>[r("button",{type:"button",disabled:o(I),class:"btn",onClick:k},p(_.$t("delete")),9,Ut)]),_:1},8,["title"])}}}),Et={class:"v-toolbar"},Nt={class:"right-actions"},At={class:"form-check mt-2 me-4"},Ht={class:"form-check-label",for:"select-mode"},Rt={class:"form-check mt-2"},zt={class:"form-check-label",for:"show-hidden"},jt={class:"file-items"},Lt=["onClick","onDblclick","onContextmenu"],Ot=["onUpdate:modelValue"],Qt=["src"],Wt={class:"title"},Gt={style:{"font-size":"0.75rem"}},Zt=["onContextmenu"],Jt={key:0,class:"no-files"},Xt={key:0,class:"file-item-info"},Kt=fe({__name:"FilesVIew",setup(x){var te,se,ae,oe;const{t:s}=Xe(),$=C([]),I=Ke(),B=I.query,k=I.params.type,_=C(Ye(((te=B.q)==null?void 0:te.toString())??"")),F=Tt(_.value),m=C(((se=F.find(e=>e.name==="path"))==null?void 0:se.value)??"");let f=((ae=F.find(e=>e.name==="dir"))==null?void 0:ae.value)??"";f||(((oe=F.find(t=>t.name==="isDir"))==null?void 0:oe.value)==="1"?f=m.value:f=m.value.substring(0,m.value.lastIndexOf("/")));const ke=C(f),y=C(!1),R=et(),{app:v}=le(tt()),ye=k==="sdcard"?v.value.sdcardPath:v.value.internalStoragePath,{loading:be,panels:u,currentDir:P,refetch:z}=yt(v,ye,ke.value),{visible:ge,index:Ce,view:De,hide:we}=st(),{createPath:Ve,createVariables:xe,createMutation:$e}=bt(v,u),{renameValue:Ie,renamePath:Fe,renameDone:Te,renameMutation:Me,renameVariables:Se}=gt(u),{internal:j,sdcard:L,refetch:U}=Ct(),{onDeleted:O}=Vt(u,P,U),{downloadFile:Q,downloadDir:qe,downloadFiles:Be}=xt(v),{view:W}=$t($,De),{selectedItem:T,select:Pe}=Dt(P,k,_,R),{canPaste:G,copy:Z,cut:Ue,paste:E}=wt(z,U),{input:Ee,upload:J,uploadChanged:X}=me(),{input:Ne,upload:K,uploadChanged:Y}=me(),{mutate:Ae,onDone:He}=ve({document:at,appApi:!0});He(e=>{Be(e.data.setTempValue.key)});const Re=[{text:s("download"),click:()=>{const e=[];if(u.value.forEach(t=>{t.items.forEach(a=>{a.checked&&e.push({path:a.path})})}),e.length===0){ie(s("select_first"),"error");return}Ae({key:ot(),value:JSON.stringify(e)})}},{text:s("delete"),click:()=>{const e=[];if(u.value.forEach(t=>{t.items.forEach(a=>{a.checked&&e.push(a)})}),e.length===0){ie(s("select_first"),"error");return}M(_e,{files:e,onDone:O})}}],{fileShowHidden:b}=le(R);m.value&&nt(()=>u.value.length,()=>{if(u.value.length>0&&m.value){const t=u.value[u.value.length-1].items.find(a=>a.path===m.value);t&&(T.value=t,m.value="")}});function ze(){var e,t,a,l;return k==="sdcard"?`${s("page_title.files")} (${s("storage_free_total",{free:w((e=L.value)==null?void 0:e.freeBytes),total:w((t=L.value)==null?void 0:t.totalBytes)})})`:`${s("page_title.files")} (${s("storage_free_total",{free:w((a=j.value)==null?void 0:a.freeBytes),total:w((l=j.value)==null?void 0:l.totalBytes)})})`}function je(e,t){if(y.value){t.checked=!t.checked;return}Pe(e,t)}function ee(e){return ce(e.name)||ue(e.name)||mt(e.name)}function Le(e,t){t.isDir||(ee(t)?W(e.items,t):Q(t.path))}function Oe(e,t){e.preventDefault();const a=[{label:s("create_folder"),onClick:()=>{Ve.value=t,M(he,{title:s("name"),placeholder:s("name"),mutation:$e,getVariables:xe})}},{label:s("upload_files"),onClick:()=>{J(t)}},{label:s("upload_folder"),onClick:()=>{K(t)}}];G()&&a.push({label:s("paste"),onClick:()=>{E(t)}}),de({x:e.x,y:e.y,items:a})}function Qe(e,t,a){e.preventDefault();let l;a.isDir?l=[{label:s("upload_files"),onClick:()=>{J(a.path)}},{label:s("upload_folder"),onClick:()=>{K(a.path)}},{label:s("download"),onClick:()=>{qe(a.path)}}]:(l=[],ee(a)&&l.push({label:s("open"),onClick:()=>{W(t.items,a)}}),l.push({label:s("download"),onClick:()=>{Q(a.path)}})),l.push({label:s("duplicate"),onClick:()=>{Z(a),E(t.dir)}}),l.push({label:s("cut"),onClick:()=>{Ue(t,a)}}),l.push({label:s("copy"),onClick:()=>{Z(a)}}),a.isDir&&G()&&l.push({label:s("paste"),onClick:()=>{E(a.path)}}),l=[...l,{label:s("rename"),onClick:()=>{Ie.value=a.name,Fe.value=a.path,M(he,{title:s("rename"),placeholder:s("name"),value:a.name,mutation:Me,getVariables:Se,done:Te})}},{label:s("delete"),onClick:()=>{M(_e,{files:[a],onDone:O})}}],de({x:e.x,y:e.y,items:l})}return lt(()=>{it.on("upload_task_done",e=>{e.status==="done"&&setTimeout(()=>{z(e.dir),U()},1e3)})}),(e,t)=>{const a=ft,l=_t,We=Pt,Ge=pt;return i(),d(D,null,[r("div",Et,[N(a,{current:ze}),r("div",Nt,[y.value?(i(),V(l,{key:0,title:e.$t("actions"),items:Re},null,8,["title"])):h("",!0),r("div",At,[A(r("input",{class:"form-check-input","onUpdate:modelValue":t[0]||(t[0]=c=>y.value=c),id:"select-mode",type:"checkbox"},null,512),[[H,y.value]]),r("label",Ht,p(e.$t("select_mode")),1)]),r("div",Rt,[A(r("input",{class:"form-check-input","onUpdate:modelValue":t[1]||(t[1]=c=>rt(b)?b.value=c:null),id:"show-hidden",type:"checkbox"},null,512),[[H,o(b)]]),r("label",zt,p(e.$t("show_hidden")),1)])])]),N(o(vt),{class:"panel-container"},{default:q(()=>[(i(!0),d(D,null,re(o(u),c=>(i(),V(o(pe),{key:c.dir},{default:q(()=>[r("div",jt,[(i(!0),d(D,null,re(c.items,n=>{var ne;return i(),d(D,{key:n.path},[!n.name.startsWith(".")||o(b)?(i(),d("div",{key:0,class:ct(["file-item",{active:(o(P)+"/").startsWith(n.path+"/")||((ne=o(T))==null?void 0:ne.path)===n.path}]),onClick:g=>je(c,n),onDblclick:g=>Le(c,n),onContextmenu:g=>Qe(g,c,n)},[y.value?A((i(),d("input",{key:0,class:"form-check-input","onUpdate:modelValue":g=>n.checked=g,type:"checkbox"},null,8,Ot)),[[H,n.checked]]):h("",!0),n.isDir?(i(),V(We,{key:1,class:"bi"})):h("",!0),o(ce)(n.name)||o(ue)(n.name)?(i(),d("img",{key:2,src:o(ut)(n.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Qt)):h("",!0),r("div",Wt,[S(p(n.name)+" ",1),r("div",Gt,[S(p(o(dt)(n.updatedAt)),1),n.isDir?h("",!0):(i(),d(D,{key:0},[S(", "+p(o(w)(n.size)),1)],64))])])],42,Lt)):h("",!0)],64)}),128)),r("div",{class:"empty",onContextmenu:n=>Oe(n,c.dir)},[c.items.filter(n=>!n.name.startsWith(".")||o(b)).length===0?(i(),d("div",Jt,p(e.$t("no_files")),1)):h("",!0)],40,Zt)])]),_:2},1024))),128)),o(u).length===0?(i(),V(o(pe),{key:0,class:"no-data-placeholder"},{default:q(()=>[S(p(e.$t(o(kt)(o(be),o(v).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):h("",!0)]),_:1}),o(T)?(i(),d("div",Xt,p(e.$t("path"))+": "+p(o(T).path),1)):h("",!0),N(Ge,{visible:o(ge),index:o(Ce),sources:$.value,onHide:o(we)},null,8,["visible","index","sources","onHide"]),r("input",{ref_key:"fileInput",ref:Ee,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...c)=>o(X)&&o(X)(...c))},null,544),r("input",{ref_key:"dirFileInput",ref:Ne,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...c)=>o(Y)&&o(Y)(...c))},null,544)],64)}}});const hs=ht(Kt,[["__scopeId","data-v-75bbcaf7"]]);export{hs as default};
