import{d as q,r as E,u as J,Z as z,b$ as G,c0 as Z,c1 as Q,c2 as X,c3 as j,c4 as Y,m as x,o as L,c as N,b as l,e as ee,f as b,J as h,a0 as S,w as se,g as f,N as ne,K as oe,j as te,k as ie,F as re,c5 as ae,c6 as ce,c7 as de,_ as le}from"./index-3c761cf5.js";import{u as ue,a as me}from"./vee-validate.esm-7f7a9a56.js";function C(s){let n=s;if(typeof n>"u"){if(typeof navigator>"u"||!navigator)return"";n=navigator.userAgent||""}return n.toLowerCase()}function $(s,n){try{return new RegExp(s,"g").exec(n)}catch{return null}}function M(){if(typeof navigator>"u"||!navigator||!navigator.userAgentData)return!1;const n=navigator.userAgentData.brands;return!!(n&&n.length)}function fe(s,n){const o=$(`(${s})((?:\\/|\\s|:)([0-9|\\.|_]+))`,n);return o?o[3]:""}function A(s){return s.replace(/_/g,".")}function V(s,n){let o=null,e="-1";return s.some(i=>{const c=$(`(${i.test})((?:\\/|\\s|:)([0-9|\\.|_]+))?`,n);return!c||i.brand?!1:(o=i,e=c[3]||"-1",i.versionAlias?e=i.versionAlias:i.versionTest&&(e=fe(i.versionTest.toLowerCase(),n)||e),e=A(e),!0)}),{preset:o,version:e}}function _(s,n){const o={brand:"",version:"-1"};return s.some(e=>{const i=W(n,e);return i?(o.brand=e.id,o.version=e.versionAlias||i.version,o.version!=="-1"):!1}),o}function W(s,n){return s.find(o=>$(`${n.test}`,o.brand.toLowerCase()))}const T=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],F=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome",versionTest:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",versionAlias:"-1",brand:!0}],B=[{test:"applewebkit",id:"webkit",versionTest:"applewebkit|safari"}],O=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],D=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"win32|windows",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"macos|macintel|mac os x",id:"mac"},{test:"android|linux armv81",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function H(s){return!!V(O,s).preset}function ve(s){const n=C(s),o=!!/mobi/g.exec(n),e={name:"unknown",version:"-1",majorVersion:-1,webview:H(n),chromium:!1,chromiumVersion:"-1",webkit:!1,webkitVersion:"-1"},i={name:"unknown",version:"-1",majorVersion:-1},{preset:c,version:d}=V(T,n),{preset:t,version:a}=V(D,n),m=V(F,n);if(e.chromium=!!m.preset,e.chromiumVersion=m.version,!e.chromium){const v=V(B,n);e.webkit=!!v.preset,e.webkitVersion=v.version}return t&&(i.name=t.id,i.version=a,i.majorVersion=parseInt(a,10)),c&&(e.name=c.id,e.version=d,e.webview&&i.name==="ios"&&e.name!=="safari"&&(e.webview=!1)),e.majorVersion=parseInt(e.version,10),{browser:e,os:i,isMobile:o,isHints:!1}}function U(s){const n=navigator.userAgentData,o=[...n.brands],e=s&&s.fullVersionList,i=n.mobile||!1,c=o[0],d=(s&&s.platform||n.platform||navigator.platform).toLowerCase(),t={name:c.brand,version:c.version,majorVersion:-1,webkit:!1,webkitVersion:"-1",chromium:!1,chromiumVersion:"-1",webview:!!_(O,o).brand||H(C())},a={name:"unknown",version:"-1",majorVersion:-1};t.webkit=!t.chromium&&B.some(r=>W(o,r));const m=_(F,o);if(t.chromium=!!m.brand,t.chromiumVersion=m.version,!t.chromium){const r=_(B,o);t.webkit=!!r.brand,t.webkitVersion=r.version}const v=D.find(r=>new RegExp(`${r.test}`,"g").exec(d));if(a.name=v?v.id:"",s&&(a.version=s.platformVersion),e&&e.length){const r=_(T,e);t.name=r.brand||t.name,t.version=r.version||t.version}else{const r=_(T,o);t.name=r.brand||t.name,t.version=r.brand&&s?s.uaFullVersion:r.version}return t.webkit&&(a.name=i?"ios":"mac"),a.name==="ios"&&t.webview&&(t.version="-1"),a.version=A(a.version),t.version=A(t.version),a.majorVersion=parseInt(a.version,10),t.majorVersion=parseInt(t.version,10),{browser:t,os:a,isMobile:i,isHints:!0}}async function we(){if(M()){const s=await navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion","fullVersionList"]);return U(s)}return be()}function be(s){return typeof s>"u"&&M()?U():ve(s)}const pe={class:"header"},ge={class:"logo"},he={class:"login-block"},_e=["placeholder"],Ve={class:"d-grid mt-4"},ke=["disabled"],Se={class:"d-grid mt-4"},ye={key:0,class:"tips"},Ee=q({__name:"LoginView",setup(s){const{handleSubmit:n,isSubmitting:o}=ue(),e=E(!1),i=E(!1),c=E("");let d;const t=window.location.protocol==="http:"?!1:!window.navigator.userAgentData,{t:a}=J(),{value:m,errorMessage:v}=me("password",z().required().min(6));function r(){fetch(`${ae()}/init`,{method:"POST",headers:ce()})}r();const R=n(async()=>{r();const w=localStorage.getItem("client_id");d=new WebSocket(`${G()}?cid=${w}&auth=1`);const p=m.value??"",k=Z(p),g=Q(k);c.value="",e.value=!1,d.onopen=async()=>{o.value=!0;const u=await we(),y=X(g,JSON.stringify({password:k,browserName:u.browser.name,browserVersion:u.browser.version,osName:u.os.name,osVersion:u.os.version,isMobile:u.isMobile}));d.send(j.codec.base64.fromBits(y))},d.onmessage=async u=>{var P;const y=Y(g,j.codec.base64.toBits(u.data)),I=JSON.parse(y);I.status==="PENDING"?i.value=!0:(localStorage.setItem("auth_token",I.token),d.close(),x.push({path:((P=x.currentRoute.value.query.redirect)==null?void 0:P.toString())??"/",replace:!0}))},d.onclose=u=>{u.reason==="abort"||u.reason==="OK"||(o.value=!1,e.value=!0,i.value=!1,c.value=`login.${u.reason?u.reason:"failed"}`)},window.setTimeout(function(){d.readyState!==1&&d.close(3001,"timeout")},2e3)});function K(){i.value=!1,e.value=!1,o.value=!1,d.close(3001,"abort")}return(w,p)=>{const k=de;return L(),N(re,null,[l("div",pe,[ee(k,{"logged-in":!1})]),l("div",ge,[l("div",null,b(w.$t("app_name")),1)]),l("div",he,[h(l("form",{onSubmit:p[1]||(p[1]=se((...g)=>f(R)&&f(R)(...g),["prevent"]))},[h(l("div",{class:"alert alert-danger",role:"alert"},b(c.value?w.$t(c.value):""),513),[[S,e.value]]),h(l("input",{type:"password",class:"form-control","onUpdate:modelValue":p[0]||(p[0]=g=>ne(m)?m.value=g:null),placeholder:f(a)("password")},null,8,_e),[[oe,f(m)]]),h(l("div",{class:"invalid-feedback"},b(f(v)?w.$t(f(v),{min:6}):""),513),[[S,f(v)]]),l("div",Ve,[l("button",{class:"btn",type:"submit",disabled:f(o)},b(w.$t(f(o)?"logging_in":"log_in")),9,ke)])],544),[[S,!i.value]]),h(l("div",null,[te(b(w.$t("login.to_continue"))+" ",1),l("div",Se,[l("button",{onClick:K,class:"btn",type:"button"},b(w.$t("cancel")),1)])],512),[[S,i.value]])]),f(t)?(L(),N("div",ye,b(w.$t("browser_warning")),1)):ie("",!0)],64)}}});const Be=le(Ee,[["__scopeId","data-v-d59a40e2"]]);export{Be as default};
