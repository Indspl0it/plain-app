import{a as ae,b as le,e as de,c as ie,_ as ce,d as ue}from"./list-b0e5ee2c.js";import{_ as re}from"./FieldId-a09be666.js";import{_ as pe}from"./Multiselect-072cb44d.js";import{_ as _e}from"./Dropdown.vuevuetypescriptsetuptruelang-3853d065.js";import{_ as fe}from"./Breadcrumb-55791723.js";import{d as me,p as he,r as i,u as ve,A as ge,n as be,B as ye,bU as ke,D as $e,t as Q,bV as we,i as Ve,C as Ce,bW as Fe,G as Te,H as Ee,I as R,U as Qe,bX as Ue,o as c,c as p,b as e,e as y,w as T,f as a,v as De,J as U,K as Se,L as Ae,M as z,g as u,N as Ie,F as D,y as P,x as qe,a9 as Be,k as S,O as Le,P as Me,Q as xe,z as H,R as J,m as Ge}from"./index-3c761cf5.js";import{c as Ke,k as O,b as Ne,a as Re}from"./search-2c6de17f.js";import{n as ze}from"./list-6498ebd9.js";import"./VModal.vuevuetypescriptsetuptruelang-d5392689.js";import"./vee-validate.esm-7f7a9a56.js";import"./baseIndexOf-70b929c6.js";const Pe={class:"v-toolbar"},He={class:"right-actions"},Je=["disabled","onClick"],Oe={class:"row mb-3"},We={class:"col-md-3 col-form-label"},Xe={class:"col-md-9"},Ye=["onKeyup"],je={class:"row mb-3"},Ze={class:"col-md-3 col-form-label"},et={class:"col-md-9"},tt={class:"actions"},st=["onClick"],ot={class:"table"},nt=e("th",null,"ID",-1),at=e("th",null,null,-1),lt=["onClick"],dt=["onUpdate:modelValue"],it=["src"],ct=["href","onClick"],ut={class:"badge"},rt=["title"],pt={key:0},_t={colspan:"7"},ft={class:"no-data-placeholder"},Et=me({__name:"FeedsView",setup(mt){var K,N;const A=he(),r=i([]),{t:_}=ve(),l=ge({text:"",feeds:[],tags:[]}),k="FEED_ENTRY",I=be().query,$=i(parseInt(((K=I.page)==null?void 0:K.toString())??"1")),w=50,V=i(0),C=i([]),W=i([]),f=i(ye(((N=I.q)==null?void 0:N.toString())??"")),q=i(""),{addToTags:X}=ae(k,r,C),{removeFromTags:Y}=le(k,r,C),{deleteItems:j}=de(ke,()=>{L()},r),F=i(!1),Z=[{text:_("add_to_tags"),click:X},{text:_("remove_from_tags"),click:Y},{text:_("delete"),click:j}],{selectAll:E,toggleSelect:B}=ie(r),{loading:ee,load:te,refetch:L}=$e({handle:(t,o)=>{o?Q(_(o),"error"):t&&(r.value=t.feedEntries.map(m=>({...m,checked:!1})),V.value=t.feedEntryCount)},document:we,variables:()=>({offset:($.value-1)*w,limit:w,query:q.value}),appApi:!0});Ve({handle:async(t,o)=>{if(o)Q(_(o),"error");else if(t){C.value=t.tags,W.value=t.feeds;const m=Ke(f.value);l.tags=[];const h=[],v=[];m.forEach(n=>{if(n.name==="text")l.text=n.value;else if(n.name==="tag"){const d=t.tags.find(s=>O(s.name)===n.value);d?(l.tags.push(d),h.push(d.id)):h.push("invalid")}else if(n.name==="feed"){const d=t.feeds.find(s=>O(s.name)===n.value);d?(l.feeds.push(d),v.push(d.id)):v.push("invalid")}});const g=[...m].filter(n=>n.name!=="tag"&&n.name!=="feed");h.forEach(n=>{g.push({name:"tag_id",op:"",value:n})}),v.forEach(n=>{g.push({name:"feed_id",op:"",value:n})}),q.value=Ne(g),await Ce(),te()}},document:Fe,variables:{type:k},appApi:!0}),Te($,t=>{H(A,`/feeds?page=${t}&q=${J(f.value)}`)});function M(){f.value=Re(l),x()}function x(){H(A,`/feeds?q=${J(f.value)}`)}Ee(()=>{R.on("refetch_by_tag_type",t=>{t===k&&L()}),R.on("feeds_fetched",t=>{F.value=!1,Q(t.error||_("feeds_synced"))})});function se(t){Ge.push(G(t))}function G(t){return`/feeds/${t.feedId}/entries/${t.id}`}const{mutate:oe}=Qe({document:Ue,appApi:!0});function ne(){F.value=!0,oe({id:""})}return(t,o)=>{const m=fe,h=_e,v=pe,g=ce,n=re,d=ue;return c(),p(D,null,[e("div",Pe,[y(m,{current:()=>`${t.$t("page_title.feeds")} (${V.value})`},null,8,["current"]),e("div",He,[e("button",{class:"btn btn-action",disabled:F.value,type:"button",onClick:T(ne,["prevent"])},a(F.value?t.$t("syncing"):t.$t("sync_feeds")),9,Je),y(h,{title:t.$t("actions"),items:Z},null,8,["title"]),y(g,{modelValue:f.value,"onUpdate:modelValue":o[2]||(o[2]=s=>f.value=s),search:x},{filters:De(()=>[e("div",Oe,[e("label",We,a(t.$t("keywords")),1),e("div",Xe,[U(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>l.text=s),class:"form-control",onKeyup:Ae(M,["enter"])},null,40,Ye),[[Se,l.text]])])]),e("div",je,[e("label",Ze,a(t.$t("tags")),1),e("div",et,[y(v,{modelValue:l.tags,"onUpdate:modelValue":o[1]||(o[1]=s=>l.tags=s),label:"name","track-by":"id",options:C.value},null,8,["modelValue","options"])])]),e("div",tt,[e("button",{type:"button",class:"btn",onClick:T(M,["stop"])},a(t.$t("search")),9,st)])]),_:1},8,["modelValue"])])]),e("table",ot,[e("thead",null,[e("tr",null,[e("th",null,[U(e("input",{class:"form-check-input",type:"checkbox",onChange:o[3]||(o[3]=(...s)=>u(B)&&u(B)(...s)),"onUpdate:modelValue":o[4]||(o[4]=s=>Ie(E)?E.value=s:null)},null,544),[[z,u(E)]])]),nt,at,e("th",null,a(t.$t("title")),1),e("th",null,a(t.$t("source")),1),e("th",null,a(t.$t("tags")),1),e("th",null,a(t.$t("published_at")),1)])]),e("tbody",null,[(c(!0),p(D,null,P(r.value,s=>(c(),p("tr",{key:s.id,class:qe({checked:s.checked}),onClick:T(b=>s.checked=!s.checked,["stop"])},[e("td",null,[U(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":b=>s.checked=b},null,8,dt),[[z,s.checked]])]),e("td",null,[y(n,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",null,[s.image?(c(),p("img",{key:0,src:u(Be)(s.image)+"&w=200&h=200",width:"50",height:"50"},null,8,it)):S("",!0)]),e("td",null,[e("a",{href:G(s),onClick:T(b=>se(s),["prevent"])},a(s.title||t.$t("no_content")),9,ct)]),e("td",null,a(s.author),1),e("td",null,[(c(!0),p(D,null,P(s.tags,b=>(c(),p("span",ut,a(b.name),1))),256))]),e("td",{class:"nowrap",title:u(Le)(s.publishedAt)},a(u(Me)(s.publishedAt)),9,rt)],10,lt))),128))]),r.value.length?S("",!0):(c(),p("tfoot",pt,[e("tr",null,[e("td",_t,[e("div",ft,a(t.$t(u(ze)(u(ee)))),1)])])]))]),V.value>w?(c(),xe(d,{key:0,modelValue:$.value,"onUpdate:modelValue":o[5]||(o[5]=s=>$.value=s),total:V.value,limit:w},null,8,["modelValue","total"])):S("",!0)],64)}}});export{Et as default};
