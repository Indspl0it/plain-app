import{aT as B,r,U as D,aU as C,aV as g,ag as b,aW as M,i as A,aX as R,u as $,t as P,aR as E,aQ as L,aY as U,aZ as S,aA as k,R as G,a_ as V,a$ as _,s as z,a as H,b0 as W,au as m,at as T,aS as j}from"./index-400f4a7b.js";import{b as O}from"./search-e9047456.js";import{b as X}from"./baseIndexOf-70b929c6.js";import{a as Y}from"./toInteger-66ec8fce.js";var Z=Math.max;function q(o,n,e){var t=o==null?0:o.length;if(!t)return-1;var a=e==null?0:Y(e);return a<0&&(a=Z(t+a,0)),X(o,B(n),a)}const ae=(o,n)=>{const e=r("");return{createPath:e,createVariables(t){return{path:e.value+"/"+t}},createMutation(){return D({document:C,options:{update:async(t,a)=>{const{fileIdToken:s}=o.value;for(const u of n.value)if(u.dir===e.value){const i=a.data.createDir;u.items.push({...i,name:g(i.path),fileId:await b(s,i.path)})}}},appApi:!0})}}},te=o=>{const n=r(""),e=r("");return{renameValue:n,renamePath:e,renameDone(t){const a=e.value,s=n.value;for(const u of o.value)u.rename(a,s,t)},renameMutation(){return D({document:M,appApi:!0})},renameVariables(t){return{path:e.value,name:t}}}},se=(o,n,e)=>({onDeleted(t){for(const a of o.value)t.forEach(s=>{a.deleteItem(s.path)});t.forEach(a=>{if(n.value.startsWith(a.path)){const s=a.path.lastIndexOf("/");n.value=a.path.substring(0,s)}}),e()}}),ne=()=>{const o=r(0),n=r(0),{refetch:e}=A({handle:(t,a)=>{a||(o.value=t.storageStats.totalBytes,n.value=t.storageStats.freeBytes)},document:R,appApi:!0});return{totalBytes:o,freeBytes:n,refetch:e}},oe=(o,n)=>{const e=r(""),t=r(""),a=r(""),s=r([]),{t:u}=$();let i=0;const{loading:x}=A({handle:async(v,f)=>{if(f)P(u(f),"error");else{const{dir:h,items:I}=v.files;a.value===""&&(e.value=h);const{fileIdToken:y}=o.value,d=[];for(const l of I){const p={...l,name:g(l.path)};(E(p.name)||L(p.name))&&(p.fileId=await b(y,l.path)),d.push(p)}const c=h.replace(e.value,"").split("/").length;for(;s.value.length>=c;)s.value.pop();if(s.value.push(new U(h,d)),n){const l=n.replace(e.value+"/","").split("/");d.length===0?i=l.length-1:i<l.length&&(a.value=e.value+"/"+l.slice(0,i+1).join("/"),i++)}}},document:S,variables:{dir:a,showHidden:!0},options:{fetchPolicy:"no-cache"},appApi:!0}),{refetch:F}=A({handle:async(v,f)=>{if(f)P(u(f),"error");else{const{dir:h,items:I}=v.files,{fileIdToken:y}=o.value,d=[];for(const c of I)d.push({...c,name:g(c.path),fileId:await b(y,c.path)});s.value.forEach(c=>{c.dir===h&&(c.items=d)})}t.value=""},document:S,variables:{dir:t,showHidden:!0},options:()=>({fetchPolicy:"no-cache",enabled:!!t.value}),appApi:!0});return{loading:x,panels:s,refetch(v){t.value=v,F()},rootDir:e,currentDir:a}},le=o=>({async downloadFile(n,e){const{fileIdToken:t}=o.value,a=await W(t,n);e?m(a+`&dl=1&name=${e}`,e):m(a+"&dl=1",g(n))},async downloadDir(n,e){const{fileIdToken:t}=o.value,a=await b(t,n),s=`${T()}/zip/dir?id=${encodeURIComponent(a)}`;e?m(s+`&name=${e}`,e):m(s,g(n))},downloadFiles(n,e){const t=`${T()}/zip/files?id=${encodeURIComponent(n)}`;e?m(t+`&name=${e}`,e):m(t,"")}}),ue=(o,n)=>({view(e,t){o.value=e.items.filter(s=>L(s.name)||E(s.name)||j(s.name)).map(s=>({path:s.path,src:"",name:g(s.path)}));const a=q(o.value,s=>s.path===t.path);n(a)}}),ie=(o,n,e)=>{const t=r(null);return{selectedItem:t,select(a,s){s.isDir?o.value=s.path:a.items.some(i=>i.path===o.value)&&a.items.some(i=>i.path===s.path)&&(o.value=a.dir);const u=[];u.push({name:"path",op:"",value:s.path}),u.push({name:"dir",op:"",value:o.value}),n.value=O(u),t.value=s,k(e,`/files?q=${G(n.value)}`)}}},re=(o,n)=>{const e=r(null),t=r(null),a=r(!1),s=r(),{mutate:u,loading:i,onDone:x,onError:F}=D({document:V,appApi:!0}),{mutate:v,loading:f,onDone:h,onError:I}=D({document:_,appApi:!0}),{t:y}=$(),d=l=>{P(y(l.message))};F(d),I(d);const c=()=>{var l;if(a.value){const p=t.value.items.findIndex(w=>w.path===e.value.path);(l=t.value)==null||l.items.splice(p,1)}e.value=null,setTimeout(()=>{o(s.value),n()},500)};return x(c),h(c),{loading:i||f,canPaste(){return!!e.value},copy(l){e.value=l,a.value=!1},cut(l,p){e.value=p,t.value=l,a.value=!0},paste(l){var w,Q;s.value=l;const p={src:(w=e.value)==null?void 0:w.path,dst:l+"/"+((Q=e.value)==null?void 0:Q.name),overwrite:!1};a.value?v(p):u(p)}}},ce=()=>{const{uploads:o}=z(H()),n=r(""),e=r();return{input:e,upload(t){n.value=t,e.value.value="",e.value.click()},uploadChanged(t){const a=t.target.files;if(!a)return;const s=[];for(let u=0;u<a.length;u++){const i=a[u];s.push({dir:n.value,file:i,status:"created",uploadedSize:0,error:""})}o.value=[...o.value,...s]}}};export{oe as a,ae as b,te as c,ne as d,ie as e,re as f,ce as g,se as h,ue as i,le as u};
