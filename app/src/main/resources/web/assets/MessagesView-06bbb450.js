import{u as Z,a as ee,b as te,c as se,_ as oe,d as ae}from"./list-b0e5ee2c.js";import{_ as ne}from"./FieldId-a09be666.js";import{_ as le}from"./Multiselect-072cb44d.js";import{_ as ce}from"./Dropdown.vuevuetypescriptsetuptruelang-3853d065.js";import{_ as ue}from"./Breadcrumb-55791723.js";import{d as ie,p as re,s as de,a as pe,r as p,u as me,A as _e,n as ge,B as he,C as fe,D as ve,t as ye,E as be,G as ke,H as $e,I as Ve,o as c,c as d,b as e,e as m,v as we,f as a,J as T,K as Se,L as Te,g as n,w as R,M as x,N as Ce,F as C,y as I,x as qe,O as De,P as Me,k as K,Q as Be,z as b,R as k}from"./index-3c761cf5.js";import{n as Ue}from"./list-6498ebd9.js";import{b as Ae,a as Fe}from"./search-2c6de17f.js";import"./VModal.vuevuetypescriptsetuptruelang-d5392689.js";import"./vee-validate.esm-7f7a9a56.js";import"./baseIndexOf-70b929c6.js";const Qe={class:"v-toolbar"},Re={class:"right-actions"},xe={class:"row mb-3"},Ie={class:"col-md-3 col-form-label"},Ke={class:"col-md-9"},Le=["onKeyup"],Ne={class:"row mb-3"},ze={class:"col-md-3 col-form-label"},Ee={class:"col-md-9"},Ge={class:"actions"},Pe=["onClick"],He={class:"table"},Je=e("th",null,"ID",-1),Oe=["onClick"],je=["onUpdate:modelValue"],We={class:"nowrap"},Xe={class:"badge"},Ye=["title"],Ze={key:0},et={colspan:"7"},tt={class:"no-data-placeholder"},_t=ie({__name:"MessagesView",setup(st){var F,Q;const _=re(),{app:L}=de(pe()),u=p([]),{t:$}=me(),i=_e({text:"",tags:[]}),g="SMS",q=ge(),D=q.query,h=p(parseInt(((F=D.page)==null?void 0:F.toString())??"1")),f=50,v=p(0),l=p(he(((Q=D.q)==null?void 0:Q.toString())??"")),M=p(""),{tags:V}=Z(g,l,i,async s=>{r&&s.push({name:"type",op:"",value:J[r].toString()}),M.value=Ae(s),await fe(),P()}),{addToTags:N}=ee(g,u,V),{removeFromTags:z}=te(g,u,V),E=[{text:$("add_to_tags"),click:N},{text:$("remove_from_tags"),click:z}],{selectAll:w,toggleSelect:B}=se(u),{loading:G,load:P,refetch:H}=ve({handle:(s,o)=>{o?ye($(o),"error"):s&&(u.value=s.messages.map(S=>({...S,checked:!1})),v.value=s.messageCount)},document:be,variables:()=>({offset:(h.value-1)*f,limit:f,query:M.value}),appApi:!0}),r=q.params.type,J={inbox:1,sent:2,drafts:3,outbox:4};ke(h,s=>{r?b(_,`/messages/${r}?page=${s}&q=${k(l.value)}`):b(_,`/messages?page=${s}&q=${k(l.value)}`)});function U(){l.value=Fe(i),A()}function A(){r?b(_,`/messages/${r}?q=${k(l.value)}`):b(_,`/messages?q=${k(l.value)}`)}return $e(()=>{Ve.on("refetch_by_tag_type",s=>{s===g&&H()})}),(s,o)=>{const S=ue,O=ce,j=le,W=oe,X=ne,Y=ae;return c(),d(C,null,[e("div",Qe,[m(S,{current:()=>`${s.$t("page_title.messages")} (${v.value})`},null,8,["current"]),e("div",Re,[m(O,{title:s.$t("actions"),items:E},null,8,["title"]),m(W,{modelValue:l.value,"onUpdate:modelValue":o[2]||(o[2]=t=>l.value=t),search:A},{filters:we(()=>[e("div",xe,[e("label",Ie,a(s.$t("keywords")),1),e("div",Ke,[T(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=t=>i.text=t),class:"form-control",onKeyup:Te(U,["enter"])},null,40,Le),[[Se,i.text]])])]),e("div",Ne,[e("label",ze,a(s.$t("tags")),1),e("div",Ee,[m(j,{modelValue:i.tags,"onUpdate:modelValue":o[1]||(o[1]=t=>i.tags=t),label:"name","track-by":"id",options:n(V)},null,8,["modelValue","options"])])]),e("div",Ge,[e("button",{type:"button",class:"btn",onClick:R(U,["stop"])},a(s.$t("search")),9,Pe)])]),_:1},8,["modelValue"])])]),e("table",He,[e("thead",null,[e("tr",null,[e("th",null,[T(e("input",{class:"form-check-input",type:"checkbox",onChange:o[3]||(o[3]=(...t)=>n(B)&&n(B)(...t)),"onUpdate:modelValue":o[4]||(o[4]=t=>Ce(w)?w.value=t:null)},null,544),[[x,n(w)]])]),Je,e("th",null,a(s.$t("content")),1),e("th",null,a(s.$t("sms_address")),1),e("th",null,a(s.$t("type")),1),e("th",null,a(s.$t("tags")),1),e("th",null,a(s.$t("time")),1)])]),e("tbody",null,[(c(!0),d(C,null,I(u.value,t=>(c(),d("tr",{key:t.id,class:qe({checked:t.checked}),onClick:R(y=>t.checked=!t.checked,["stop"])},[e("td",null,[T(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":y=>t.checked=y},null,8,je),[[x,t.checked]])]),e("td",null,[m(X,{id:t.id,raw:t},null,8,["id","raw"])]),e("td",null,a(t.body),1),e("td",null,a(t.address),1),e("td",We,a(s.$t(`message_type.${t.type}`)),1),e("td",null,[(c(!0),d(C,null,I(t.tags,y=>(c(),d("span",Xe,a(y.name),1))),256))]),e("td",{title:n(De)(t.date),class:"nowrap"},a(n(Me)(t.date)),9,Ye)],10,Oe))),128))]),u.value.length?K("",!0):(c(),d("tfoot",Ze,[e("tr",null,[e("td",et,[e("div",tt,a(s.$t(n(Ue)(n(G),n(L).permissions,"READ_SMS"))),1)])])]))]),v.value>f?(c(),Be(Y,{key:0,modelValue:h.value,"onUpdate:modelValue":o[5]||(o[5]=t=>h.value=t),total:v.value,limit:f},null,8,["modelValue","total"])):K("",!0)],64)}}});export{_t as default};
