import{u as ut,a as dt,b as rt,e as pt,c as _t,_ as mt,d as ht}from"./list-e7ef4cf1.js";import{_ as ft}from"./call-outline-rounded-ba14f10c.js";import{_ as vt}from"./FieldId-da304ce7.js";import{l as gt,_ as yt}from"./Multiselect-90c04a89.js";import{_ as bt}from"./Dropdown.vuevuetypescriptsetuptruelang-172ac0f4.js";import{_ as $t}from"./Breadcrumb-23f5606f.js";import{d as kt,n as Ct,y as Vt,z as Tt,r as _,u as wt,A as St,m as qt,B as At,C as Dt,S as Lt,D as It,t as Mt,T as Ut,G as xt,H as Bt,I as Qt,U as Gt,V as Nt,o as n,c as d,a as e,b as h,q as Rt,e as a,J as S,K as Ft,L as Kt,j as l,w as $,M as N,N as zt,F as q,v as R,s as Et,f as jt,Q as F,W as Ot,O as Pt,P as Ht,g as K,x as k,R as C,X as Jt,Y as Wt}from"./index-89decb33.js";import{n as Xt}from"./list-6498ebd9.js";import{_ as Yt}from"./DeleteConfirm.vuevuetypescriptsetuptruelang-5ca1a67e.js";import{b as z}from"./search-0684184d.js";import"./VModal.vuevuetypescriptsetuptruelang-6d140002.js";import"./vee-validate.esm-09f61400.js";import"./baseIndexOf-70b929c6.js";const Zt={class:"v-toolbar"},te={class:"right-actions"},ee={class:"row mb-3"},se={class:"col-md-3 col-form-label"},oe={class:"col-md-9"},ae=["onKeyup"],le={class:"row mb-3"},ne={class:"col-md-3 col-form-label"},ce={class:"col-md-9"},ie={class:"actions"},ue=["onClick"],de={class:"table"},re=e("th",null,"ID",-1),pe={class:"actions one"},_e=["onClick"],me=["onUpdate:modelValue"],he={key:0,class:"spinner spinner-sm"},fe={class:"nowrap"},ve={class:"badge"},ge=["title"],ye={class:"actions one"},be=["onClick"],$e={key:0},ke={colspan:"10"},Ce={class:"no-data-placeholder"},Ge=kt({__name:"CallsView",setup(Ve){var Q,G;const f=Ct(),{app:E}=Vt(Tt()),u=_([]),{t:m}=wt(),c=St({text:"",tags:[]}),v="CALL",A=qt(),D=A.query,g=_(parseInt(((Q=D.page)==null?void 0:Q.toString())??"1")),y=50,b=_(0),i=_(At(((G=D.q)==null?void 0:G.toString())??"")),L=_(""),{tags:V}=ut(v,i,c,async t=>{r&&t.push({name:"type",op:"",value:X[r].toString()}),L.value=z(t),await Dt(),W()}),{addToTags:j}=dt(v,u,V),{removeFromTags:O}=rt(v,u,V),{deleteItems:P}=pt(Lt,()=>{M()},u),H=[{text:m("add_to_tags"),click:j},{text:m("remove_from_tags"),click:O},{text:m("delete"),click:P}],{selectAll:T,toggleSelect:I}=_t(u),{loading:J,load:W,refetch:M}=It({handle:(t,o)=>{o?Mt(m(o),"error"):t&&(u.value=t.calls.map(w=>({...w,checked:!1})),b.value=t.callCount)},document:Ut,variables:()=>({offset:(g.value-1)*y,limit:y,query:L.value}),appApi:!0}),r=A.params.type,X={incoming:1,outgoing:2,missed:3};xt(g,t=>{r?k(f,`/calls/${r}?page=${t}&q=${C(i.value)}`):k(f,`/calls?page=${t}&q=${C(i.value)}`)});function U(){const t=[];for(const o of c.tags)t.push({name:"tag",op:"",value:gt.kebabCase(o.name)});c.text&&t.push({name:"text",op:"",value:c.text}),i.value=z(t),x()}function x(){r?k(f,`/calls/${r}?q=${C(i.value)}`):k(f,`/calls?q=${C(i.value)}`)}Bt(()=>{Qt.on("refetch_by_tag_type",t=>{t===v&&M()})});function Y(t){if(!t)return"";const o=[];return t.isp&&o.push(m("phone_isp_type."+t.isp)),t.city===t.province?o.push(t.city):o.push(`${t.province}${t.city}`),o.join(", ")}const B=_(""),{mutate:Z,loading:tt}=Gt({document:Nt,appApi:!0});function et(t){B.value=t.id,Z({number:t.number})}function st(t){Jt(Yt,{id:t.id,name:t.id,gql:Wt`
      mutation DeleteCall($id: ID!) {
        deleteCalls(ids: [$id])
      }
    `,appApi:!0,typeName:"Call"})}return(t,o)=>{const w=$t,ot=bt,at=yt,lt=mt,nt=vt,ct=ft,it=ht;return n(),d(q,null,[e("div",Zt,[h(w,{current:()=>`${t.$t("page_title.calls")} (${b.value})`},null,8,["current"]),e("div",te,[h(ot,{title:t.$t("actions"),items:H},null,8,["title"]),h(lt,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=s=>i.value=s),search:x},{filters:Rt(()=>[e("div",ee,[e("label",se,a(t.$t("keywords")),1),e("div",oe,[S(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>c.text=s),class:"form-control",onKeyup:Kt(U,["enter"])},null,40,ae),[[Ft,c.text]])])]),e("div",le,[e("label",ne,a(t.$t("tags")),1),e("div",ce,[h(at,{modelValue:c.tags,"onUpdate:modelValue":o[1]||(o[1]=s=>c.tags=s),label:"name","track-by":"id",options:l(V)},null,8,["modelValue","options"])])]),e("div",ie,[e("button",{type:"button",class:"btn",onClick:$(U,["stop"])},a(t.$t("search")),9,ue)])]),_:1},8,["modelValue"])])]),e("table",de,[e("thead",null,[e("tr",null,[e("th",null,[S(e("input",{class:"form-check-input",type:"checkbox",onChange:o[3]||(o[3]=(...s)=>l(I)&&l(I)(...s)),"onUpdate:modelValue":o[4]||(o[4]=s=>zt(T)?T.value=s:null)},null,544),[[N,l(T)]])]),re,e("th",null,a(t.$t("name")),1),e("th",null,a(t.$t("phone_number")),1),e("th",null,a(t.$t("phone_geo")),1),e("th",null,a(t.$t("duration")),1),e("th",null,a(t.$t("type")),1),e("th",null,a(t.$t("tags")),1),e("th",null,a(t.$t("started_at")),1),e("th",pe,a(t.$t("actions")),1)])]),e("tbody",null,[(n(!0),d(q,null,R(u.value,s=>(n(),d("tr",{key:s.id,class:Et({checked:s.checked}),onClick:$(p=>s.checked=!s.checked,["stop"])},[e("td",null,[S(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":p=>s.checked=p},null,8,me),[[N,s.checked]])]),e("td",null,[h(nt,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",null,a(s.name),1),e("td",null,[jt(a(s.number)+" ",1),l(tt)&&B.value===s.id?(n(),d("i",he)):(n(),F(ct,{key:1,class:"bi bi-btn",onClick:$(p=>et(s),["stop"])},null,8,["onClick"]))]),e("td",null,a(Y(s.geo)),1),e("td",null,a(l(Ot)(s.duration)),1),e("td",fe,a(t.$t("call_type."+s.type)),1),e("td",null,[(n(!0),d(q,null,R(s.tags,p=>(n(),d("span",ve,a(p.name),1))),256))]),e("td",{class:"nowrap",title:l(Pt)(s.startedAt)},a(l(Ht)(s.startedAt)),9,ge),e("td",ye,[e("a",{href:"#",class:"v-link",onClick:$(p=>st(s),["stop"])},a(t.$t("delete")),9,be)])],10,_e))),128))]),u.value.length?K("",!0):(n(),d("tfoot",$e,[e("tr",null,[e("td",ke,[e("div",Ce,a(t.$t(l(Xt)(l(J),l(E).permissions,"READ_CALL_LOG"))),1)])])]))]),b.value>y?(n(),F(it,{key:0,modelValue:g.value,"onUpdate:modelValue":o[5]||(o[5]=s=>g.value=s),total:b.value,limit:y},null,8,["modelValue","total"])):K("",!0)],64)}}});export{Ge as default};
