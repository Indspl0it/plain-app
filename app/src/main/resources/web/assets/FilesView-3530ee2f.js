import{o as l,c as d,b as i,d as pe,U as me,Y as Qe,a1 as We,Q as b,v as M,f as p,g as a,u as Ge,r as y,n as Oe,B as Ze,p as Je,s as oe,a as Xe,ae as Ke,aM as Ye,t as se,aN as et,X as x,G as tt,H as ot,I as st,e as B,k as m,J as E,M as N,N as at,F as $,y as ae,x as nt,aO as ne,aP as ie,ab as it,j as F,P as lt,l as P,aj as ct,aQ as rt,_ as ut}from"./index-4e7fbfe1.js";import{_ as dt}from"./Dropdown.vuevuetypescriptsetuptruelang-cdabf3b0.js";import{_ as pt}from"./Breadcrumb-6debfc1a.js";import{c as le}from"./index-83f42dfb.js";import{g as ce,M as mt}from"./splitpanes.es-70c46460.js";import{n as ht}from"./list-6498ebd9.js";import{b as _t,c as ft,d as vt,e as kt,f as yt,g as bt,h as re,i as gt,a as Ct,j as Dt}from"./files-1f0e9b03.js";import{_ as wt}from"./VModal.vuevuetypescriptsetuptruelang-fe406bcd.js";import{t as Vt}from"./truncate-47efa096.js";import{_ as ue}from"./EditValueModal.vuevuetypescriptsetuptruelang-4739bdfc.js";import{c as xt}from"./search-3e0e61ee.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-039c5f80.js";import"./stringToArray-eaf16b6f.js";import"./vee-validate.esm-a962d6bf.js";const $t={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ft=i("path",{fill:"currentColor",d:"M4 20q-.825 0-1.413-.588T2 18V6q0-.825.588-1.413T4 4h5.175q.4 0 .763.15t.637.425L12 6h8q.825 0 1.413.588T22 8v10q0 .825-.588 1.413T20 20H4ZM4 6v12h16V8h-8.825l-2-2H4Zm0 0v12V6Z"},null,-1),Mt=[Ft];function Tt(g,o){return l(),d("svg",$t,Mt)}const It={name:"material-symbols-folder-outline-rounded",render:Tt},St=["disabled"],de=pe({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(g){const o=g,{mutate:C,loading:A,onDone:T}=me({document:Qe`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function D(){C({paths:o.files.map(h=>h.path)})}return T(()=>{o.onDone(o.files),We()}),(h,f)=>{const I=wt;return l(),b(I,{class:"delete-modal",title:h.$t("confirm_to_delete_name",{name:a(Vt)(g.files.map(_=>_.name).join(", "),{length:200})})},{action:M(()=>[i("button",{type:"button",disabled:a(A),class:"btn",onClick:D},p(h.$t("delete")),9,St)]),_:1},8,["title"])}}}),qt={class:"page-container container"},Ut={class:"main"},Bt={class:"v-toolbar"},Et={class:"right-actions"},Nt={class:"form-check mt-2 me-4"},Pt={class:"form-check-label",for:"select-mode"},At={class:"form-check mt-2"},Ht={class:"form-check-label",for:"show-hidden"},Rt={class:"file-items"},zt=["onClick","onDblclick","onContextmenu"],jt=["onUpdate:modelValue"],Lt=["src"],Qt={class:"title"},Wt={style:{"font-size":"0.75rem"}},Gt=["onContextmenu"],Ot={key:0,class:"no-files"},Zt={key:0,class:"file-item-info"},Jt=pe({__name:"FilesView",setup(g){var K,Y,ee;const{t:o}=Ge(),C=y([]),T=Oe().query,D=y(Ze(((K=T.q)==null?void 0:K.toString())??"")),h=xt(D.value),f=y(((Y=h.find(e=>e.name==="path"))==null?void 0:Y.value)??""),I=y(((ee=h.find(e=>e.name==="dir"))==null?void 0:ee.value)??""),_=y(!1),H=Je(),{app:w}=oe(Xe()),{loading:he,panels:u,currentDir:S,refetch:R}=_t(w,I.value),{visible:_e,index:fe,view:ve,hide:ke}=Ke(),{createPath:ye,createVariables:be,createMutation:ge}=ft(w,u),{renameValue:Ce,renamePath:De,renameDone:we,renameMutation:Ve,renameVariables:xe}=vt(u),{totalBytes:$e,freeBytes:Fe,refetch:q}=kt(),{onDeleted:z}=gt(u,S,q),{downloadFile:j,downloadDir:Me,downloadFiles:Te}=Ct(w),{view:L}=Dt(C,ve),{selectedItem:V,select:Ie}=yt(S,D,H),{canPaste:Q,copy:W,cut:Se,paste:U}=bt(R,q),{input:qe,upload:G,uploadChanged:O}=re(),{input:Ue,upload:Z,uploadChanged:J}=re(),{mutate:Be,onDone:Ee}=me({document:Ye,appApi:!0});Ee(e=>{Te(e.data.setTempValue.key)});const Ne=[{text:o("download"),click:()=>{const e=[];if(u.value.forEach(t=>{t.items.forEach(s=>{s.checked&&e.push({path:s.path})})}),e.length===0){se(o("select_first"),"error");return}Be({key:et(),value:JSON.stringify(e)})}},{text:o("delete"),click:()=>{const e=[];if(u.value.forEach(t=>{t.items.forEach(s=>{s.checked&&e.push(s)})}),e.length===0){se(o("select_first"),"error");return}x(de,{files:e,onDone:z})}}],{fileShowHidden:v}=oe(H);f.value&&tt(()=>u.value.length,()=>{if(u.value.length>0&&f.value){const t=u.value[u.value.length-1].items.find(s=>s.path===f.value);t&&(V.value=t,f.value="")}});function Pe(){return`${o("page_title.files")} (${o("storage_free_total",{free:P(Fe.value),total:P($e.value)})})`}function Ae(e,t){if(_.value){t.checked=!t.checked;return}Ie(e,t)}function X(e){return ne(e.name)||ie(e.name)||rt(e.name)}function He(e,t){t.isDir||(X(t)?L(e,t):j(t.path))}function Re(e,t){e.preventDefault();const s=[{label:o("create_folder"),onClick:()=>{ye.value=t,x(ue,{title:o("name"),placeholder:o("name"),mutation:ge,getVariables:be})}},{label:o("upload_files"),onClick:()=>{G(t)}},{label:o("upload_folder"),onClick:()=>{Z(t)}}];Q()&&s.push({label:o("paste"),onClick:()=>{U(t)}}),le({x:e.x,y:e.y,items:s})}function ze(e,t,s){e.preventDefault();let r;s.isDir?r=[{label:o("upload_files"),onClick:()=>{G(s.path)}},{label:o("upload_folder"),onClick:()=>{Z(s.path)}},{label:o("download"),onClick:()=>{Me(s.path)}}]:(r=[],X(s)&&r.push({label:o("open"),onClick:()=>{L(t,s)}}),r.push({label:o("download"),onClick:()=>{j(s.path)}})),r.push({label:o("duplicate"),onClick:()=>{W(s),U(t.dir)}}),r.push({label:o("cut"),onClick:()=>{Se(t,s)}}),r.push({label:o("copy"),onClick:()=>{W(s)}}),s.isDir&&Q()&&r.push({label:o("paste"),onClick:()=>{U(s.path)}}),r=[...r,{label:o("rename"),onClick:()=>{Ce.value=s.name,De.value=s.path,x(ue,{title:o("rename"),placeholder:o("name"),value:s.name,mutation:Ve,getVariables:xe,done:we})}},{label:o("delete"),onClick:()=>{x(de,{files:[s],onDone:z})}}],le({x:e.x,y:e.y,items:r})}return ot(()=>{st.on("upload_task_done",e=>{e.status==="done"&&setTimeout(()=>{R(e.dir),q()},1e3)})}),(e,t)=>{const s=pt,r=dt,je=It,Le=ct;return l(),d("div",qt,[i("div",Ut,[i("div",Bt,[B(s,{current:Pe}),i("div",Et,[_.value?(l(),b(r,{key:0,title:e.$t("actions"),items:Ne},null,8,["title"])):m("",!0),i("div",Nt,[E(i("input",{class:"form-check-input","onUpdate:modelValue":t[0]||(t[0]=c=>_.value=c),id:"select-mode",type:"checkbox"},null,512),[[N,_.value]]),i("label",Pt,p(e.$t("select_mode")),1)]),i("div",At,[E(i("input",{class:"form-check-input","onUpdate:modelValue":t[1]||(t[1]=c=>at(v)?v.value=c:null),id:"show-hidden",type:"checkbox"},null,512),[[N,a(v)]]),i("label",Ht,p(e.$t("show_hidden")),1)])])]),B(a(mt),{class:"panel-container"},{default:M(()=>[(l(!0),d($,null,ae(a(u),c=>(l(),b(a(ce),{key:c.dir},{default:M(()=>[i("div",Rt,[(l(!0),d($,null,ae(c.items,n=>{var te;return l(),d($,{key:n.path},[!n.name.startsWith(".")||a(v)?(l(),d("div",{key:0,class:nt(["file-item",{active:(a(S)+"/").startsWith(n.path+"/")||((te=a(V))==null?void 0:te.path)===n.path}]),onClick:k=>Ae(c,n),onDblclick:k=>He(c,n),onContextmenu:k=>ze(k,c,n)},[_.value?E((l(),d("input",{key:0,class:"form-check-input","onUpdate:modelValue":k=>n.checked=k,type:"checkbox"},null,8,jt)),[[N,n.checked]]):m("",!0),n.isDir?(l(),b(je,{key:1,class:"bi"})):m("",!0),a(ne)(n.name)||a(ie)(n.name)?(l(),d("img",{key:2,src:a(it)(n.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Lt)):m("",!0),i("div",Qt,[F(p(n.name)+" ",1),i("div",Wt,[F(p(a(lt)(n.updatedAt)),1),n.isDir?m("",!0):(l(),d($,{key:0},[F(", "+p(a(P)(n.size)),1)],64))])])],42,zt)):m("",!0)],64)}),128)),i("div",{class:"empty",onContextmenu:n=>Re(n,c.dir)},[c.items.filter(n=>!n.name.startsWith(".")||a(v)).length===0?(l(),d("div",Ot,p(e.$t("no_files")),1)):m("",!0)],40,Gt)])]),_:2},1024))),128)),a(u).length===0?(l(),b(a(ce),{key:0,class:"no-data-placeholder"},{default:M(()=>[F(p(e.$t(a(ht)(a(he),a(w).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):m("",!0)]),_:1}),a(V)?(l(),d("div",Zt,p(e.$t("path"))+": "+p(a(V).path),1)):m("",!0),B(Le,{visible:a(_e),index:a(fe),sources:C.value,onHide:a(ke)},null,8,["visible","index","sources","onHide"]),i("input",{ref_key:"fileInput",ref:qe,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...c)=>a(O)&&a(O)(...c))},null,544),i("input",{ref_key:"dirFileInput",ref:Ue,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...c)=>a(J)&&a(J)(...c))},null,544)])])}}});const mo=ut(Jt,[["__scopeId","data-v-9f3a38af"]]);export{mo as default};
